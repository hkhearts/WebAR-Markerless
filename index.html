<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Temple AR MarkerLess</title>
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
</head>

<body>
  <script>
    AFRAME.registerComponent('ar-logic', {
      init: function () {
        this.hud = document.querySelector("#hud");
        this.circle = document.querySelector("#circle");
        this.box = document.querySelector("#box");

        // Listen for screen taps
        this.el.sceneEl.addEventListener('select', () => {
          
          if (this.circle.object3D.visible) {
            let pos = this.circle.object3D.position;
            
            // Move the box and boost the Y-axis so it sits ON the floor
            this.box.object3D.position.set(pos.x, pos.y + 0.05, pos.z);
            this.box.setAttribute('visible', true);
          }
        });
      },

      tick: function () {
        // 1. Check for the camera, matching your original script logic
        let cam = document.querySelector("#cam");
        if (!cam) { return; }

        // Start building the message string
        let debugMessage = "cam detected\n";

        // 2. Check if the hit-test is currently finding a surface
        if (this.circle && this.circle.object3D.visible) {
          let pos = this.circle.object3D.position;
          
          // Append the live collision points (X and Z) to the message
          debugMessage += `Collision Points: ${pos.x.toFixed(2)} ${pos.z.toFixed(2)}`;
        } else {
          // If no surface is found yet
          debugMessage += "Scanning for surface...";
        }

        // 3. Push the combined text to the HUD every frame
        this.showMessage(debugMessage);
      },

      // Helper function to update the text on the screen
      showMessage: function (message) {
        if (this.hud) {
          this.hud.setAttribute('value', message);
        }
      }
    });
  </script>

  <a-scene webxr="requiredFeatures: hit-test, local-floor;" ar-logic renderer="logarithmicDepthBuffer: true;">
    
    <a-camera id="cam" position="0 1.6 0">
      <a-text id="hud" 
        value="Loading..." 
        position="0 -0.1 -0.25"
        align="center"
        wrap-count="40"
        color="lime"
        geometry="primitive: plane; width: 0.3; height: 0.05"
        material="color: black; opacity: 0.5">
      </a-text>
    </a-camera>

    <a-ring
      id="circle"
      ar-hit-test
      rotation="-90 0 0"
      radius-inner="0.02"
      radius-outer="0.04"
      color="teal">
    </a-ring>

    <a-box id="box" visible="false" color="red" scale="0.1 0.1 0.1"></a-box>

  </a-scene>
</body>
</html>