<!DOCTYPE html>
<html>
<head>
  <title>Markerless AR</title>

  <!-- A-Frame -->
  <script src="https://aframe.io/releases/1.7.1/aframe.min.js"></script>

  <!-- WebXR AR -->
  <script src="https://cdn.jsdelivr.net/npm/aframe-extras@6.1.1/dist/aframe-extras.min.js"></script>

  <style>
    body { margin: 0; overflow: hidden; }
  </style>
</head>

<body>
  <a-scene
    vr-mode-ui="enabled: false"
    renderer="colorManagement: true"
    webxr="optionalFeatures: hit-test, local-floor"
    xr-mode-ui="enabled: true">

    <!-- Reticle for surface detection -->
    <a-entity
      id="reticle"
      geometry="primitive: ring; radiusInner: 0.04; radiusOuter: 0.05"
      material="color: yellow; shader: flat"
      rotation="-90 0 0"
      visible="false">
    </a-entity>

    <!-- Car Model -->
    <a-gltf-model
      id="car"
      src="model/arCar.glb"
      scale="0.2 0.2 0.2"
      visible="false">
    </a-gltf-model>

    <!-- Camera -->
    <a-camera></a-camera>
  </a-scene>

  <script>
    const scene = document.querySelector("a-scene");
    const reticle = document.querySelector("#reticle");
    const car = document.querySelector("#car");

    scene.addEventListener("enter-vr", () => {
      const xrSession = scene.renderer.xr.getSession();
      const viewerSpace = xrSession.requestReferenceSpace("viewer");
      const hitTestSource = xrSession.requestHitTestSource({ space: viewerSpace });

      const refSpace = scene.renderer.xr.getReferenceSpace();

      scene.renderer.setAnimationLoop((timestamp, frame) => {
        if (!frame) return;

        const hitTestResults = frame.getHitTestResults(hitTestSource);
        if (hitTestResults.length > 0) {
          const hit = hitTestResults[0];
          const pose = hit.getPose(refSpace);

          reticle.setAttribute("visible", true);
          reticle.object3D.position.set(
            pose.transform.position.x,
            pose.transform.position.y,
            pose.transform.position.z
          );
        }
      });
    });

    scene.addEventListener("click", () => {
      if (!reticle.getAttribute("visible")) return;

      car.setAttribute("visible", true);
      car.object3D.position.copy(reticle.object3D.position);
    });
  </script>
</body>
</html>
